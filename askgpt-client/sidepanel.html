<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="sidepanel.css">
  <link rel="stylesheet" href="sidepanel-workers.css">
  <script src="marked.min.js"></script>
  <script src="prompts.js"></script>
</head>

<body class="sp-shell" data-theme="light">
  <!-- Minimal Header -->
  <header class="sp-header">
    <div class="sp-title">
      <img src="icons/icon-32.png" class="sp-logo" alt="AI Supporter logo">
      <div class="sp-name">AI Supporter</div>
    </div>

    <div class="sp-header-actions">
      <!-- Help Button with Hover Popup -->
      <div class="sp-help-container">
        <button id="sp-help-btn" class="sp-header-btn" title="Quick Commands Help">?</button>
        <div class="sp-help-popup" id="sp-help-popup">
          <div class="sp-help-title">âš¡ Quick Commands</div>

          <div class="sp-help-section">
            <div class="sp-help-label">Workers</div>
            <div class="sp-help-row">
              <span class="sp-help-chip" data-insert="@chatgpt">ğŸ¤– @chatgpt</span>
              <span class="sp-help-chip" data-insert="@gemini">âœ¨ @gemini</span>
            </div>
            <div class="sp-help-row">
              <span class="sp-help-chip" data-insert="@perplexity">ğŸ” @perplexity</span>
              <span class="sp-help-chip" data-insert="@copilot">ğŸš€ @copilot</span>
              <span class="sp-help-chip" data-insert="@grok">ğ• @grok</span>
            </div>
          </div>

          <div class="sp-help-section">
            <div class="sp-help-label">Shortcuts</div>
            <div class="sp-help-row">
              <span class="sp-help-chip small" data-insert="@gpt">@gpt</span>
              <span class="sp-help-chip small" data-insert="@gem">@gem</span>
              <span class="sp-help-chip small" data-insert="@pplx">@pplx</span>
              <span class="sp-help-chip small" data-insert="@search">@search</span>
            </div>
          </div>

          <div class="sp-help-section">
            <div class="sp-help-label">Tools</div>
            <div class="sp-help-row">
              <span class="sp-help-chip tool" data-insert="/summary">/summary</span>
              <span class="sp-help-chip tool" data-insert="/analyze">/analyze</span>
              <span class="sp-help-chip tool" data-insert="/extract">/extract</span>
            </div>
          </div>

          <div class="sp-help-section">
            <div class="sp-help-label">Patterns</div>
            <div class="sp-help-patterns">
              <code>@worker msg</code> â†’ Direct
              <code>@a > @b</code> â†’ Chain
              <code>@a @b</code> â†’ Parallel
            </div>
          </div>
        </div>
      </div>

      <button id="sp-theme-toggle" class="sp-header-btn" title="Toggle theme">
        <span class="theme-icon-light">â˜€ï¸</span>
        <span class="theme-icon-dark">ğŸŒ™</span>
      </button>
      <button id="sp-more-btn" class="sp-header-btn sp-more-btn" title="More options">â‹®</button>

      <!-- More Menu Dropdown -->
      <div id="sp-more-menu" class="sp-more-menu">
        <button class="sp-more-option" id="sp-refresh-opt">ğŸ”„ Refresh</button>
        <button class="sp-more-option" id="sp-settings-opt">âš™ï¸ Settings</button>
        <div class="sp-more-divider"></div>
        <button class="sp-more-option" id="sp-clear-chat-opt">ğŸ—‘ï¸ Clear Chat</button>
      </div>
    </div>
  </header>

  <!-- Worker Panel Popup (Hidden by default) -->
  <div class="sp-worker-panel" id="sp-worker-panel">
    <div class="sp-worker-panel-header">
      <span>ğŸ‘· Workers</span>
      <div class="sp-panel-actions">
        <button class="sp-panel-refresh" id="sp-worker-panel-refresh" title="Refresh status">ğŸ”„</button>
        <button class="sp-panel-close" id="sp-worker-panel-close">Ã—</button>
      </div>
    </div>
    <div class="sp-worker-list" id="sp-worker-list">
      <!-- Workers will be populated by JS -->
    </div>
  </div>

  <div class="sp-main">
    <!-- Welcome Screen (shown when no messages) -->
    <section id="sp-welcome" class="sp-welcome">
      <div class="sp-welcome-icon">âœ¨</div>
      <h2 class="sp-welcome-title">AI Supporter</h2>
      <p class="sp-welcome-desc">Select text on any page, right-click, and choose an AI action.</p>
      <p class="sp-welcome-hint">Type <code>@</code> to mention a worker, or click <strong>?</strong> for help.</p>
    </section>

    <!-- Answer Container -->
    <section id="sp-answer" class="sp-answer sp-chat"></section>

    <!-- Input Area -->
    <section class="sp-input-area">
      <div class="sp-input-box">
        <!-- @ Mention Autocomplete -->
        <div id="sp-mention-popup" class="sp-mention-popup">
          <div class="sp-mention-header">Select Worker</div>
          <button class="sp-mention-option" data-worker="chatgpt_web">
            <span class="sp-mention-icon">ğŸ¤–</span>
            <span class="sp-mention-name">ChatGPT</span>
            <span class="sp-mention-tag">Main</span>
          </button>
          <button class="sp-mention-option" data-worker="gemini_web">
            <span class="sp-mention-icon">âœ¨</span>
            <span class="sp-mention-name">Gemini</span>
            <span class="sp-mention-tag">Vision</span>
          </button>
          <button class="sp-mention-option" data-worker="perplexity_web">
            <span class="sp-mention-icon">ğŸ”</span>
            <span class="sp-mention-name">Perplexity</span>
            <span class="sp-mention-tag">Search</span>
          </button>
          <button class="sp-mention-option" data-worker="copilot_web">
            <span class="sp-mention-icon">ğŸš€</span>
            <span class="sp-mention-name">Copilot</span>
            <span class="sp-mention-tag">Office</span>
          </button>
          <button class="sp-mention-option" data-worker="grok_web">
            <span class="sp-mention-icon">ğ•</span>
            <span class="sp-mention-name">Grok</span>
            <span class="sp-mention-tag">Twitter</span>
          </button>
        </div>
        <textarea id="sp-prompt" class="sp-textarea" rows="1"
          placeholder="Message... or @worker to route directly"></textarea>
        <div class="sp-input-footer">
          <div class="sp-input-left">
            <!-- Tools Selector -->
            <button id="sp-tools-btn" class="sp-selector-btn">
              <span>âš¡ Tools</span>
              <svg width="10" height="10" viewBox="0 0 20 20" fill="currentColor">
                <path
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
              </svg>
            </button>
            <div id="sp-tools-dropdown" class="sp-dropdown sp-tools-dropdown">
              <div class="sp-dropdown-header">Mode</div>
              <button class="sp-dropdown-option active" data-mode="custom">ğŸ’¬ Custom (Free Chat)</button>
              <div class="sp-dropdown-header">Image</div>
              <button class="sp-dropdown-option" data-action="capture">ğŸ“· Capture Screen</button>
              <button class="sp-dropdown-option" data-action="find-similar">ğŸ” Find Similar</button>
              <button class="sp-dropdown-option" data-action="images">ğŸ–¼ï¸ Page Images</button>
              <div class="sp-dropdown-header">Page</div>
              <button class="sp-dropdown-option" data-action="summarize">ğŸ“ Summarize</button>
              <button class="sp-dropdown-option" data-action="analyze">ğŸ”¬ Analyze</button>
            </div>
          </div>

          <!-- Worker Avatars (Overlapping Group Chat Style) -->
          <div class="sp-worker-avatars" id="sp-worker-avatars">
            <div class="sp-avatar off" data-worker="chatgpt_web" title="ChatGPT (Main)">ğŸ¤–</div>
            <div class="sp-avatar off" data-worker="gemini_web" title="Gemini">âœ¨</div>
            <div class="sp-avatar off" data-worker="perplexity_web" title="Perplexity">ğŸ”</div>
            <div class="sp-avatar off" data-worker="copilot_web" title="Copilot">ğŸš€</div>
            <div class="sp-avatar off" data-worker="grok_web" title="Grok">ğ•</div>
            <button class="sp-avatar-manage" id="sp-open-worker-panel" title="Manage Workers">âš™ï¸</button>
          </div>

          <button id="sp-send" class="sp-send-btn" title="Send">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </div>
      <div id="sp-status" class="sp-status"></div>
    </section>
  </div>

  <script src="sidepanel-workers.js"></script>
  <script src="sidepanel.js"></script>
</body>

</html>